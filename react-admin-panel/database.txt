-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.admin_actions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  admin_id uuid NOT NULL,
  action_type text NOT NULL,
  target_table text NOT NULL,
  target_id uuid,
  action_details jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT admin_actions_pkey PRIMARY KEY (id),
  CONSTRAINT admin_actions_admin_id_fkey FOREIGN KEY (admin_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.booking_analytics (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  booking_id uuid NOT NULL,
  event_type text NOT NULL,
  event_time timestamp with time zone NOT NULL DEFAULT now(),
  metadata jsonb,
  CONSTRAINT booking_analytics_pkey PRIMARY KEY (id),
  CONSTRAINT booking_analytics_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id)
);
CREATE TABLE public.booking_statuses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  order smallint UNIQUE,
  influencer_status text,
  CONSTRAINT booking_statuses_pkey PRIMARY KEY (id)
);
CREATE TABLE public.bookings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL,
  influencer_id uuid NOT NULL,
  status_id uuid NOT NULL,
  scheduled_time timestamp with time zone NOT NULL,
  completed_time timestamp with time zone,
  notes text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  service_id uuid NOT NULL,
  updated_at timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
  script text,
  script_created_at timestamp with time zone,
  script_approved_at timestamp with time zone,
  feedback text,
  script_rejected_count smallint DEFAULT '0'::smallint,
  CONSTRAINT bookings_pkey PRIMARY KEY (id),
  CONSTRAINT bookings_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id),
  CONSTRAINT bookings_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id),
  CONSTRAINT bookings_status_id_fkey FOREIGN KEY (status_id) REFERENCES public.booking_statuses(id),
  CONSTRAINT bookings_service_id_fkey FOREIGN KEY (service_id) REFERENCES public.services(id)
);
CREATE TABLE public.cart_items (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  cart_id uuid NOT NULL,
  service_id uuid NOT NULL,
  quantity integer NOT NULL DEFAULT 1,
  price numeric NOT NULL,
  current_status text NOT NULL DEFAULT 'awaiting approval from influencer'::text,
  status_history jsonb DEFAULT '[]'::jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  notes text,
  location text,
  delivery_date timestamp with time zone,
  CONSTRAINT cart_items_pkey PRIMARY KEY (id),
  CONSTRAINT cart_items_cart_id_fkey FOREIGN KEY (cart_id) REFERENCES public.carts(id),
  CONSTRAINT cart_items_service_id_fkey FOREIGN KEY (service_id) REFERENCES public.services(id)
);
CREATE TABLE public.carts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  status boolean NOT NULL DEFAULT true CHECK (status = ANY (ARRAY[true, false])),
  CONSTRAINT carts_pkey PRIMARY KEY (id),
  CONSTRAINT carts_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.chat_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  chat_room_id uuid NOT NULL,
  sender_id uuid NOT NULL,
  message text NOT NULL,
  message_type text NOT NULL DEFAULT 'text'::text CHECK (message_type = ANY (ARRAY['text'::text, 'image'::text, 'file'::text, 'system'::text])),
  attachment_url text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  is_read boolean NOT NULL DEFAULT false,
  read_at timestamp with time zone,
  CONSTRAINT chat_messages_pkey PRIMARY KEY (id),
  CONSTRAINT chat_messages_chat_room_id_fkey FOREIGN KEY (chat_room_id) REFERENCES public.chat_rooms(id),
  CONSTRAINT chat_messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.chat_rooms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  booking_id uuid NOT NULL UNIQUE,
  customer_id uuid NOT NULL,
  influencer_id uuid NOT NULL,
  is_active boolean NOT NULL DEFAULT true,
  last_message_id uuid,
  last_message_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT chat_rooms_pkey PRIMARY KEY (id),
  CONSTRAINT chat_rooms_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id),
  CONSTRAINT chat_rooms_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id),
  CONSTRAINT chat_rooms_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.contact_support_info (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  title character varying NOT NULL,
  content text NOT NULL,
  contact_type character varying NOT NULL,
  priority integer DEFAULT 1,
  is_active boolean DEFAULT true,
  last_updated timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_by uuid,
  CONSTRAINT contact_support_info_pkey PRIMARY KEY (id),
  CONSTRAINT contact_support_info_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.contract_amendments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  contract_instance_id uuid,
  amendment_type character varying CHECK (amendment_type::text = ANY (ARRAY['extension'::character varying, 'modification'::character varying, 'termination'::character varying, 'addendum'::character varying]::text[])),
  description text NOT NULL,
  changes jsonb DEFAULT '{}'::jsonb,
  approved_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT contract_amendments_pkey PRIMARY KEY (id),
  CONSTRAINT contract_amendments_contract_instance_id_fkey FOREIGN KEY (contract_instance_id) REFERENCES public.contract_instances(id),
  CONSTRAINT contract_amendments_approved_by_fkey FOREIGN KEY (approved_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.contract_instances (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  template_id uuid,
  customer_id uuid,
  influencer_id uuid,
  status character varying DEFAULT 'draft'::character varying CHECK (status::text = ANY (ARRAY['draft'::character varying, 'pending'::character varying, 'active'::character varying, 'completed'::character varying, 'cancelled'::character varying, 'expired'::character varying]::text[])),
  variables jsonb DEFAULT '{}'::jsonb,
  generated_content text,
  signed_at timestamp with time zone,
  expires_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT contract_instances_pkey PRIMARY KEY (id),
  CONSTRAINT contract_instances_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.contract_templates(id),
  CONSTRAINT contract_instances_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id),
  CONSTRAINT contract_instances_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.contract_signatures (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  contract_instance_id uuid,
  signer_id uuid,
  signer_type character varying CHECK (signer_type::text = ANY (ARRAY['customer'::character varying, 'influencer'::character varying, 'admin'::character varying]::text[])),
  signature_data text,
  signed_at timestamp with time zone DEFAULT now(),
  ip_address inet,
  user_agent text,
  CONSTRAINT contract_signatures_pkey PRIMARY KEY (id),
  CONSTRAINT contract_signatures_signer_id_fkey FOREIGN KEY (signer_id) REFERENCES public.profiles(id),
  CONSTRAINT contract_signatures_contract_instance_id_fkey FOREIGN KEY (contract_instance_id) REFERENCES public.contract_instances(id)
);
CREATE TABLE public.contract_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  title character varying NOT NULL,
  template_type character varying NOT NULL CHECK (template_type::text = ANY (ARRAY['collaboration'::character varying, 'content_creation'::character varying, 'ambassador'::character varying, 'sponsorship'::character varying, 'partnership'::character varying]::text[])),
  content text NOT NULL,
  variables jsonb DEFAULT '[]'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT contract_templates_pkey PRIMARY KEY (id)
);
CREATE TABLE public.coupon_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  description text,
  color character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT coupon_categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.coupon_usage_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  coupon_id uuid,
  user_id uuid,
  order_id uuid,
  discount_amount numeric NOT NULL,
  used_at timestamp with time zone DEFAULT now(),
  CONSTRAINT coupon_usage_log_pkey PRIMARY KEY (id),
  CONSTRAINT coupon_usage_log_coupon_id_fkey FOREIGN KEY (coupon_id) REFERENCES public.discount_coupons(id),
  CONSTRAINT coupon_usage_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.detailed_ratings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  rating_id uuid NOT NULL,
  category_id uuid NOT NULL,
  rating integer NOT NULL CHECK (rating >= 1 AND rating <= 5),
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT detailed_ratings_pkey PRIMARY KEY (id),
  CONSTRAINT detailed_ratings_rating_id_fkey FOREIGN KEY (rating_id) REFERENCES public.ratings(id),
  CONSTRAINT detailed_ratings_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.rating_categories(id)
);
CREATE TABLE public.discount_coupons (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  description text,
  discount_type character varying NOT NULL CHECK (discount_type::text = ANY (ARRAY['percentage'::character varying, 'fixed_amount'::character varying]::text[])),
  discount_value numeric NOT NULL CHECK (discount_value > 0::numeric),
  minimum_order_amount numeric DEFAULT 0,
  maximum_discount_amount numeric,
  usage_limit integer,
  usage_count integer DEFAULT 0,
  usage_limit_per_user integer DEFAULT 1,
  valid_from timestamp with time zone DEFAULT now(),
  valid_until timestamp with time zone,
  is_active boolean DEFAULT true,
  is_public boolean DEFAULT true,
  applicable_to character varying DEFAULT 'all'::character varying CHECK (applicable_to::text = ANY (ARRAY['all'::character varying, 'specific_products'::character varying, 'categories'::character varying]::text[])),
  product_ids ARRAY,
  category_ids ARRAY,
  user_restrictions character varying DEFAULT 'all'::character varying CHECK (user_restrictions::text = ANY (ARRAY['all'::character varying, 'new_users'::character varying, 'existing_users'::character varying, 'specific_users'::character varying]::text[])),
  restricted_user_ids ARRAY,
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT discount_coupons_pkey PRIMARY KEY (id),
  CONSTRAINT discount_coupons_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id)
);
CREATE TABLE public.faq_items (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  question text NOT NULL,
  answer text NOT NULL,
  category character varying NOT NULL,
  tags ARRAY DEFAULT '{}'::text[],
  order_index integer DEFAULT 0,
  is_active boolean DEFAULT true,
  view_count integer DEFAULT 0,
  helpful_count integer DEFAULT 0,
  last_updated timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_by uuid,
  CONSTRAINT faq_items_pkey PRIMARY KEY (id),
  CONSTRAINT faq_items_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.favorites (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  influencer_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT favorites_pkey PRIMARY KEY (id),
  CONSTRAINT favorites_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT favorites_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.fcm_tokens (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  user_id uuid,
  token text NOT NULL,
  device_type text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT fcm_tokens_pkey PRIMARY KEY (id),
  CONSTRAINT fcm_tokens_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.group_chat_members (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_chat_id uuid NOT NULL,
  user_id uuid NOT NULL,
  joined_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT group_chat_members_pkey PRIMARY KEY (id),
  CONSTRAINT group_chat_members_group_chat_id_fkey FOREIGN KEY (group_chat_id) REFERENCES public.group_chats(id),
  CONSTRAINT group_chat_members_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.group_chats (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  created_by uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT group_chats_pkey PRIMARY KEY (id),
  CONSTRAINT group_chats_created_by_fkey FOREIGN KEY (created_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.group_messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  group_chat_id uuid NOT NULL,
  sender_id uuid NOT NULL,
  content text NOT NULL,
  read_by ARRAY NOT NULL DEFAULT '{}'::uuid[],
  sent_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT group_messages_pkey PRIMARY KEY (id),
  CONSTRAINT group_messages_group_chat_id_fkey FOREIGN KEY (group_chat_id) REFERENCES public.group_chats(id),
  CONSTRAINT group_messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.help_sections (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  title character varying NOT NULL,
  content text NOT NULL,
  category character varying NOT NULL,
  order_index integer DEFAULT 0,
  is_active boolean DEFAULT true,
  last_updated timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_by uuid,
  CONSTRAINT help_sections_pkey PRIMARY KEY (id),
  CONSTRAINT help_sections_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.influencer_media (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  influencer_id uuid NOT NULL,
  file_url text NOT NULL,
  file_type character varying NOT NULL CHECK (file_type::text = ANY (ARRAY['image'::character varying, 'video'::character varying]::text[])),
  file_name character varying,
  file_size bigint,
  mime_type character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT influencer_media_pkey PRIMARY KEY (id),
  CONSTRAINT influencer_media_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.influencer_ratings (
  influencer_id uuid NOT NULL,
  average_rating numeric NOT NULL DEFAULT 0,
  review_count integer NOT NULL DEFAULT 0,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT influencer_ratings_pkey PRIMARY KEY (influencer_id),
  CONSTRAINT influencer_ratings_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.legal_notices (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  title character varying NOT NULL,
  content text NOT NULL,
  category character varying NOT NULL DEFAULT 'general'::character varying,
  is_active boolean DEFAULT true,
  version integer DEFAULT 1,
  last_updated timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  updated_by uuid,
  CONSTRAINT legal_notices_pkey PRIMARY KEY (id),
  CONSTRAINT legal_notices_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.message_attachments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  message_id uuid,
  group_message_id uuid,
  file_url text NOT NULL,
  file_type text,
  uploaded_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT message_attachments_pkey PRIMARY KEY (id),
  CONSTRAINT message_attachments_message_id_fkey FOREIGN KEY (message_id) REFERENCES public.messages(id),
  CONSTRAINT message_attachments_group_message_id_fkey FOREIGN KEY (group_message_id) REFERENCES public.group_messages(id)
);
CREATE TABLE public.messages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  sender_id uuid NOT NULL,
  receiver_id uuid NOT NULL,
  content text NOT NULL,
  sent_at timestamp with time zone NOT NULL DEFAULT now(),
  is_read boolean NOT NULL DEFAULT false,
  CONSTRAINT messages_pkey PRIMARY KEY (id),
  CONSTRAINT messages_sender_id_fkey FOREIGN KEY (sender_id) REFERENCES public.profiles(id),
  CONSTRAINT messages_receiver_id_fkey FOREIGN KEY (receiver_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.moderation_queue (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  reported_by uuid NOT NULL,
  content_type text NOT NULL,
  content_id uuid NOT NULL,
  reason text NOT NULL,
  status text NOT NULL DEFAULT 'pending'::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  reviewed_by uuid,
  reviewed_at timestamp with time zone,
  CONSTRAINT moderation_queue_pkey PRIMARY KEY (id),
  CONSTRAINT moderation_queue_reported_by_fkey FOREIGN KEY (reported_by) REFERENCES public.profiles(id),
  CONSTRAINT moderation_queue_reviewed_by_fkey FOREIGN KEY (reviewed_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  type text NOT NULL,
  message text NOT NULL,
  is_read boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  booking_id uuid NOT NULL,
  payer_id uuid NOT NULL,
  payee_id uuid NOT NULL,
  amount numeric NOT NULL,
  currency text NOT NULL DEFAULT 'USD'::text,
  status text NOT NULL DEFAULT 'pending'::text,
  payment_method text,
  transaction_reference text,
  paid_at timestamp with time zone,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT payments_pkey PRIMARY KEY (id),
  CONSTRAINT payments_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id),
  CONSTRAINT payments_payer_id_fkey FOREIGN KEY (payer_id) REFERENCES public.profiles(id),
  CONSTRAINT payments_payee_id_fkey FOREIGN KEY (payee_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.platform_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  commission_percentage numeric NOT NULL,
  updated_by uuid,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT platform_settings_pkey PRIMARY KEY (id),
  CONSTRAINT platform_settings_updated_by_fkey FOREIGN KEY (updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.profile_views (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  profile_id uuid NOT NULL,
  viewer_id uuid,
  viewed_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT profile_views_pkey PRIMARY KEY (id),
  CONSTRAINT profile_views_profile_id_fkey FOREIGN KEY (profile_id) REFERENCES public.profiles(id),
  CONSTRAINT profile_views_viewer_id_fkey FOREIGN KEY (viewer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.profiles (
  id uuid NOT NULL,
  name text NOT NULL,
  email text NOT NULL UNIQUE,
  role USER-DEFINED NOT NULL DEFAULT 'customer'::user_role,
  bio text,
  profile_image_url text,
  is_verified boolean NOT NULL DEFAULT false,
  is_suspended boolean NOT NULL DEFAULT false,
  suspension_reason text,
  created_by_admin_id uuid,
  is_approved boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  country text,
  phone bigint UNIQUE,
  phone_code text,
  updated_at timestamp with time zone DEFAULT (now() AT TIME ZONE 'utc'::text),
  fcm_token text,
  fcm_token_updated_at timestamp with time zone,
  CONSTRAINT profiles_pkey PRIMARY KEY (id),
  CONSTRAINT profiles_id_fkey FOREIGN KEY (id) REFERENCES auth.users(id),
  CONSTRAINT profiles_created_by_admin_id_fkey FOREIGN KEY (created_by_admin_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.rating_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  display_order integer DEFAULT 0,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT rating_categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.ratings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  booking_id uuid NOT NULL UNIQUE,
  customer_id uuid NOT NULL,
  influencer_id uuid NOT NULL,
  rating integer NOT NULL CHECK (rating >= 1 AND rating <= 5),
  review_text text,
  created_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at timestamp with time zone NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT ratings_pkey PRIMARY KEY (id),
  CONSTRAINT ratings_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id),
  CONSTRAINT ratings_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id),
  CONSTRAINT ratings_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.reviews (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  reviewer_id uuid NOT NULL,
  influencer_id uuid NOT NULL,
  rating integer NOT NULL CHECK (rating >= 1 AND rating <= 5),
  review_text text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT reviews_pkey PRIMARY KEY (id),
  CONSTRAINT reviews_reviewer_id_fkey FOREIGN KEY (reviewer_id) REFERENCES public.profiles(id),
  CONSTRAINT reviews_influencer_id_fkey FOREIGN KEY (influencer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.script_approvals (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  booking_id uuid NOT NULL,
  customer_id uuid NOT NULL,
  action text NOT NULL CHECK (action = ANY (ARRAY['approve'::text, 'decline'::text])),
  feedback text,
  decline_count integer NOT NULL DEFAULT 0,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT script_approvals_pkey PRIMARY KEY (id),
  CONSTRAINT script_approvals_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id),
  CONSTRAINT script_approvals_customer_id_fkey FOREIGN KEY (customer_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.service_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  created_by_admin_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  thumb text,
  icon text,
  CONSTRAINT service_categories_pkey PRIMARY KEY (id),
  CONSTRAINT service_categories_created_by_admin_id_fkey FOREIGN KEY (created_by_admin_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.service_category_mappings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  service_type_id uuid NOT NULL,
  category_id uuid NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT service_category_mappings_pkey PRIMARY KEY (id),
  CONSTRAINT service_category_mappings_service_type_id_fkey FOREIGN KEY (service_type_id) REFERENCES public.service_types(id),
  CONSTRAINT service_category_mappings_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.service_categories(id)
);
CREATE TABLE public.service_partners (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  contact_email text,
  contact_phone text,
  created_by_admin_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT service_partners_pkey PRIMARY KEY (id),
  CONSTRAINT service_partners_created_by_admin_id_fkey FOREIGN KEY (created_by_admin_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.service_platforms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  service_id uuid NOT NULL,
  platform_id uuid NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT service_platforms_pkey PRIMARY KEY (id),
  CONSTRAINT service_platforms_service_id_fkey FOREIGN KEY (service_id) REFERENCES public.services(id),
  CONSTRAINT service_platforms_platform_id_fkey FOREIGN KEY (platform_id) REFERENCES public.social_media_platforms(id)
);
CREATE TABLE public.service_types (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  created_by_admin_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT service_types_pkey PRIMARY KEY (id),
  CONSTRAINT service_types_created_by_admin_id_fkey FOREIGN KEY (created_by_admin_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.services (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  primary_influencer_id uuid NOT NULL,
  invited_influencer_id uuid,
  is_invite_accepted boolean DEFAULT false,
  about_us text,
  title text NOT NULL,
  description text NOT NULL,
  thumbnail text,
  min_duration_days integer NOT NULL,
  location_required boolean DEFAULT false,
  is_flash_deal boolean DEFAULT false,
  flash_from timestamp with time zone,
  flash_to timestamp with time zone,
  category_id uuid,
  platform_id uuid,
  service_type USER-DEFINED DEFAULT 'normal'::service_type_enum,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  price real DEFAULT '0'::real,
  offer_price real DEFAULT '0'::real,
  currency text DEFAULT 'USD'::text,
  platform_ids ARRAY,
  CONSTRAINT services_pkey PRIMARY KEY (id),
  CONSTRAINT services_primary_influencer_id_fkey FOREIGN KEY (primary_influencer_id) REFERENCES public.profiles(id),
  CONSTRAINT services_invited_influencer_id_fkey FOREIGN KEY (invited_influencer_id) REFERENCES public.profiles(id),
  CONSTRAINT services_category_id_fkey FOREIGN KEY (category_id) REFERENCES public.service_categories(id),
  CONSTRAINT services_platform_id_fkey FOREIGN KEY (platform_id) REFERENCES public.social_media_platforms(id)
);
CREATE TABLE public.social_links (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  platform_id uuid NOT NULL,
  handle text NOT NULL,
  profile_url text,
  is_verified_on_app boolean NOT NULL DEFAULT false,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT social_links_pkey PRIMARY KEY (id),
  CONSTRAINT social_links_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT social_links_platform_id_fkey FOREIGN KEY (platform_id) REFERENCES public.social_media_platforms(id)
);
CREATE TABLE public.social_media_platforms (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL,
  icon_url text,
  created_by_admin_id uuid,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT social_media_platforms_pkey PRIMARY KEY (id),
  CONSTRAINT social_media_platforms_created_by_admin_id_fkey FOREIGN KEY (created_by_admin_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.social_stats (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  social_link_id uuid NOT NULL,
  followers_count integer NOT NULL,
  engagement_rate numeric NOT NULL,
  last_updated_by uuid,
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT social_stats_pkey PRIMARY KEY (id),
  CONSTRAINT social_stats_social_link_id_fkey FOREIGN KEY (social_link_id) REFERENCES public.social_links(id),
  CONSTRAINT social_stats_last_updated_by_fkey FOREIGN KEY (last_updated_by) REFERENCES public.profiles(id)
);
CREATE TABLE public.support_categories (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  name character varying NOT NULL UNIQUE,
  description text,
  icon character varying,
  color character varying DEFAULT '#1890ff'::character varying,
  is_active boolean DEFAULT true,
  order_index integer DEFAULT 0,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_categories_pkey PRIMARY KEY (id)
);
CREATE TABLE public.support_ticket_responses (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ticket_id uuid NOT NULL,
  responder_id uuid NOT NULL,
  message text NOT NULL,
  is_internal boolean DEFAULT false,
  attachments ARRAY DEFAULT '{}'::text[],
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_ticket_responses_pkey PRIMARY KEY (id),
  CONSTRAINT support_ticket_responses_ticket_id_fkey FOREIGN KEY (ticket_id) REFERENCES public.support_tickets(id),
  CONSTRAINT support_ticket_responses_responder_id_fkey FOREIGN KEY (responder_id) REFERENCES public.profiles(id)
);
CREATE TABLE public.support_tickets (
  id uuid NOT NULL DEFAULT uuid_generate_v4(),
  ticket_number character varying NOT NULL UNIQUE,
  user_id uuid,
  subject character varying NOT NULL,
  message text NOT NULL,
  category character varying NOT NULL,
  priority character varying NOT NULL DEFAULT 'medium'::character varying,
  status character varying NOT NULL DEFAULT 'open'::character varying,
  assigned_to uuid,
  response_count integer DEFAULT 0,
  last_response_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT support_tickets_pkey PRIMARY KEY (id),
  CONSTRAINT support_tickets_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.profiles(id),
  CONSTRAINT support_tickets_assigned_to_fkey FOREIGN KEY (assigned_to) REFERENCES public.profiles(id)
);
CREATE TABLE public.transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  booking_id uuid NOT NULL,
  amount numeric NOT NULL,
  currency text NOT NULL DEFAULT 'USD'::text,
  status text NOT NULL,
  payment_method text,
  transaction_time timestamp with time zone NOT NULL DEFAULT now(),
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT transactions_pkey PRIMARY KEY (id),
  CONSTRAINT transactions_booking_id_fkey FOREIGN KEY (booking_id) REFERENCES public.bookings(id)
);